#!/usr/bin/env perl

use utf8;
use Unicode::GCString;

my $str = '5mplmeðŸ’©9sUe75ki9KÂ®ruotZdpfhpaogjxHjciaibondvuo0qUuybnruzkcndVxabjqOcvevgjsuevCcbvrj0hqunqmikqrngp5hG';

$str = "\x{301}5mplme\x{1f4a9}9sUe75ki9K\x{ae}ruotZdpfhpaogjxHjciaibondvuo0qUuybnruzkcndVxabjqOcvevgjsuevCcbvrj0hqunqmikqrngp5hG";

$str = 'ðŸ¤£ðŸ‡¨ðŸ‡¦ðŸ‡¨ðŸ‡¦ðŸ§ Ã³ðŸ‡¦ðŸ‡ºðŸ‡ºðŸ‡¸ðŸ‡ºðŸ‡¸xÌohðŸ‡¨ðŸ‡¦ðŸ˜…Ã¡ðŸ‘‹ðŸ»tÌðŸ˜…â€ðŸ§‘ðŸ¤£ðŸ™ðŸ»sðŸ« ðŸ’©ðŸ¿vÌcðŸ‘â¤ï¸ðŸ¼â€ðŸ’»ðŸ‘ŽðŸ’©ðŸ™ðŸ»oÌnhÌðŸ˜‚ðŸ¤£jlðŸ˜€ðŸ½ðŸ‡¨ðŸ‡¦ðŸ¥³ðŸ‡ºðŸ‡¸cðŸ§ ðŸ¤£ðŸ‡¨ðŸ‡¦cÌnðŸ˜¡tðŸ˜‚ðŸ˜adÌðŸ˜‚vÌoÌewÌsÌðŸ‘‹ðŸ‘â€ðŸŒºðŸ‘ŽdðŸ˜â€ðŸŒºðŸ§ jÌiðŸ‘‹ðŸ‡¨ðŸ‡¦ðŸ˜ðŸ»â€ðŸ§‘oðŸ˜Å„ðŸ˜‚â€ðŸ§‘tðŸ‡ºðŸ‡¸iðŸ§ Ä‡ðŸ‡¦ðŸ‡ºðŸ’©ðŸ‡¦ðŸ‡ºpðŸ˜€Ã­ðŸ˜¡ðŸ‡¦ðŸ‡ºmÌðŸ‡¨ðŸ‡¦ðŸ‘ŽzðŸ§ ðŸ˜ŽðŸ‘‹ðŸ½ðŸ’©ðŸ½ÄºðŸ’©ðŸ‘ðŸ¼ðŸ‡¨ðŸ‡¦ðŸ˜‚';

print _number_of_characters($str), "\n";

sub _number_of_characters
{
	my $value = $_[0];

	return if(!defined($value));

	# if($value !~ /[^[:ascii:]]/) {
		# return length($value);
	# }
	# Decode only if it's not already a Perl character string
	$value = decode_utf8($value) unless utf8::is_utf8($value);

	my $gc = Unicode::GCString->new($value);
	return $gc->length;   # visible characters
}
