#!/usr/bin/perl
use strict;
use warnings;
use IO::Socket::INET;

# Define UDP port for syslog
my $port = 514;

# Create UDP socket
my $socket = IO::Socket::INET->new(
    LocalPort => $port,
    Proto     => 'udp'
) or die "Could not create socket: $!\n";

print "Syslog server listening on UDP port $port...\n";

while (1) {
    my $message;
    my $remote_address = $socket->recv($message, 1024);
    
    if ($remote_address) {
        my ($port, $ip) = unpack_sockaddr_in($remote_address);
        my $remote_ip = inet_ntoa($ip);
        print "[$remote_ip] $message\n";
    }
}

# Close socket (unreachable in an infinite loop)
$socket->close();
